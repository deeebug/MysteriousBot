<?php
## ################################################## ##
##                   MysteriousBot                    ##
## -------------------------------------------------- ##
##  [*] Package: MysteriousBot                        ##
##                                                    ##
##  [!] License: $LICENSE--------$                    ##
##  [!] Registered to: $DOMAIN----------------------$ ##
##  [!] Expires: $EXPIRES-$                           ##
##                                                    ##
##  [?] File name: webui.min.js                       ##
##                                                    ##
##  [*] Author: debug <jtdroste@gmail.com>            ##
##  [*] Created: 6/19/2011                            ##
##  [*] Last edit: 6/19/2011                          ##
## ################################################## ##

defined('Y_SO_MYSTERIOUS') or die('External script access is forbidden.');
?>
$(document).ready(function(){$(".notification").hide();$("#sockets-list").hide();$("#console-output").hide();$("#shutdown").hide();c()});var e=0,f="<?=$authhash?>";
function c(){$("#botlist-view").click(function(){g("bots-list");h();return!1});$("#socket-view").click(function(){g("sockets-list");i();return!1});$("#console-view").click(function(){g("console-output");j();return!1});$("#shutdown-bot").click(function(){if(confirmed=confirm("Are you sure you want to shutdown MysteriousBot?"))$("#time").html((new Date).getHours()+":"+(new Date).getMinutes()),g("shutdown"),$.get("api/shutdownbot"),$("#botlist-view").hide(),$("#socket-view").hide(),$("#console-view").hide(),
$("#shutdown-bot").hide();return!1});$("#plugin-load").click(function(){var a=[];$.each($("input[class='plugin-checkbox-affected']:checked"),function(){a.push($(this).val())});$.get("api/loadplugin",{a:f,e:$("#plugin-select").val(),d:a.join(",")},function(a){a=a.split("::");a[0]=="ERROR"&&alert("Error loading: "+a[1]);f=a[2]});$("#plugin-select").val("");$.each($("input[class='plugin-checkbox-affected']:checked"),function(){$(this).removeAttr("checked")});return!1});h()}
function h(){$.get("api/getbots",{a:f},function(a){jsondata=k(a);$("#botlist").html('<tr id="botlist-header-noremove">'+$("#botlist-header-noremove").html()+"</tr>");$("#plugin-checkbox").html("");f=jsondata.auth;delete jsondata.auth;$.each(jsondata,function(a,b){b.status==!0?(status='<span class="connected">Connected</span>',uri='<a href="#" class="bot-shutdown" bot="'+b.uuid+'">Shutdown</a>'):(status='<span class="disconnected">Disconnected</span>',uri='<a href="#" class="bot-boot" bot="'+b.uuid+
'">Boot</a>');finishdata="<tr><td>"+status+"</td><td>"+b.uuid+"</td><td>"+b.server+":"+b.port+"</td><td>"+b.nick+"</td><td>"+b.ident+"</td><td>"+b.name+"</td><td>"+b.type+"</td><td>"+b.channels+"</td><td>"+uri+"</td></tr>";$("#botlist").append(finishdata);type=b.is_server==!0?"server":"client";b.status==!0&&($("#plugin-checkbox").append('<input type="checkbox" class="plugin-checkbox-affected" name="affected[]" value="'+type+"-"+b.uuid+'" /> '+b.uuid),b.is_server==!0&&b.children!==void 0&&($("#plugin-checkbox").append(" (Affects ALL Server-Clients)"),
$.each(b.children,function(a,d){finishdata="<tr><td></td><td>"+d.uuid+"</td><td>"+d.server+":"+d.port+"</td><td>"+d.nick+"</td><td>"+d.ident+"</td><td>"+d.name+"</td><td>"+d.type+"</td><td>"+d.channels+"</td><td>N/A</td></tr>";$("#botlist").append(finishdata);$("#plugin-checkbox").append('<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" class="plugin-checkbox-affected" name="affected[]" value="'+b.uuid+"-"+d.uuid+'" /> '+d.uuid)})),$("#plugin-checkbox").append("<br />"))});
l()});$.get("api/loadedplugins",{a:f},function(a){$("#plugin-loaded-plugins").html("");jsondata=k(a);f=jsondata.key;delete jsondata.key;$.each(jsondata,function(a,b){$("#plugin-loaded-plugins").append("<li>"+b+"</li>")})})}
function i(){$.get("api/getsockets",{a:f},function(a){jsondata=k(a);$(".sockets").remove();f=jsondata.auth;delete jsondata.auth;$.each(jsondata,function(a,b){disconnectlink='<a href="#" class="socket-disconnect" sid="'+b.id+'">Disconnect</a>';finishdata='<tr class="sockets"><td>'+b.id+"</td><td>"+b.type+"</td><td>"+b.host+"</td><td>"+b.port+"</td><td>"+b.ssl+"</td><td>"+b.record+"</td><td>"+b.callback+"</td><td>"+disconnectlink+"</td></tr>";$("#socketlist").append(finishdata)});$(".socket-disconnect").click(function(){$(".message").html("Disconnecting socket id "+
$(this).attr("sid"));$(".notification").show();$.get("api/socketshutdown",{f:$(this).attr("sid"),a:f},function(a){a=a.split("::");a[0]=="ERROR"&&alert("Error disconnecting: "+a[1]);f=a[2];i()});$(".notification").hide();return!1})})}
function l(){$(".bot-boot").unbind();$(".bot-shutdown").unbind();$(".bot-boot").click(function(){$(".message").html("Booting bot UUID "+$(this).attr("bot"));$(".notification").show();$.get("api/boot",{uuid:$(this).attr("bot"),a:f},function(a){a=a.split("::");a[0]=="ERROR"&&alert("Error booting: "+a[1]);f=a[2];h()});$(".notification").hide();return!1});$(".bot-shutdown").click(function(){$(".message").html("Shutting down bot UUID "+$(this).attr("bot"));$(".notification").show();$.get("api/shutdown",
{uuid:$(this).attr("bot"),a:f},function(a){a=a.split("::");a[0]=="ERROR"&&alert("Error shutting down: "+a[1]);f=a[2];h()});$(".notification").hide();return!1})}function j(){$("#console-output-append").html("Loading.....");$.get("api/checkconsole",{a:f},function(a){a=a.split("::");a[0]=="ERROR"&&$("#console-output-append").html(a[1]);f=a[2]});$("#console-output-append").html()=="Loading....."&&($("#console-output-append").html(""),m(),e=setInterval("MysteriousBot.updateconsole()",5E3))}
function m(){$.get("api/consolepoll",{a:f},function(a){jsondata=k(a);f=jsondata.key;delete jsondata.key;finaldata=null;$.each(jsondata,function(a,b){finaldata=finaldata+b+"<br />"});$("#console-output-append").html(finaldata);document.getElementById("console-terminal").scrollTop=document.getElementById("console-terminal").scrollHeight})}function g(a){$("#bots-list").hide();$("#sockets-list").hide();$("#console-output").hide();$("#shutdown").hide();clearInterval(e);$("#"+a).show()}
function k(a){var d=this.window.JSON;if(typeof d==="object"&&typeof d.parse==="function")try{return d.parse(a)}catch(b){if(!(b instanceof SyntaxError))throw Error("Unexpected error type in json_decode()");this.b=this.b||{};this.b.c=4;return null}d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,
"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+a+")");this.b=this.b||{};this.b.c=4;return null};
